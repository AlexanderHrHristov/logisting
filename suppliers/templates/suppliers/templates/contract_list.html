{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container mt-4">
<h2 class="mb-4" style="color: white; font-weight: bold;">üìÑ –†–µ–≥–∏—Å—Ç—ä—Ä –Ω–∞ –¥–æ–≥–æ–≤–æ—Ä–∏</h2>

<form method="get" class="filters-row" style="display: flex; gap: 1rem; align-items: center;">
  <div>
    {{ filter.form.supplier.label_tag }} {{ filter.form.supplier }}
  </div>
  <div>
    {{ filter.form.contract_type.label_tag }} {{ filter.form.contract_type }}
  </div>
  <div>
    {{ filter.form.expiry_date.label_tag }} {{ filter.form.expiry_date }}
  </div>
  <div>
    {{ filter.form.is_active.label_tag }} {{ filter.form.is_active }}
  </div>
  <button type="submit" class="btn btn-sm btn-primary">–§–∏–ª—Ç—Ä–∏—Ä–∞–π</button>
</form>




    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>–î–æ—Å—Ç–∞–≤—á–∏–∫</th>
                    <th>–¢–∏–ø</th>
                    <th>–ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞</th>
                    <th>–ò–∑—Ç–∏—á–∞ –Ω–∞</th>
                    <th>–ê–∫—Ç–∏–≤–µ–Ω</th>
                    <th>–§–∞–π–ª</th>
                    <th class="text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
            {% for contract in contracts %}
                <tr>
                    <td>{{ contract.supplier.name }}</td>
                    <td>{{ contract.get_contract_type_display }}</td>
                    <td>{{ contract.signed_date|date:"d.m.Y" }}</td>
                    <td>{{ contract.expiry_date|date:"d.m.Y" }}</td>
                    <td>
                        {% if contract.is_active %}
                            <span class="badge bg-success">–î–∞</span>
                        {% else %}
                            <span class="badge bg-danger">–ù–µ</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if contract.file %}
                            <a href="{{ contract.file.url }}" target="_blank" class="btn btn-sm btn-outline-primary">–û—Ç–≤–æ—Ä–∏</a>
                        {% else %}
                            <span class="text-muted">–ù—è–º–∞</span>
                        {% endif %}
                    </td>
                    <td class="text-center">
                        {% if user.groups.all.0.name == "Legal" %}
                            <a href="{% url 'suppliers:contract-update' contract.pk %}" class="btn btn-sm btn-warning">–†–µ–¥–∞–∫—Ü–∏—è</a>
                            <form action="{% url 'suppliers:contract-toggle' contract.pk %}" method="post" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm {% if contract.is_active %}btn-outline-danger{% else %}btn-outline-success{% endif %}">
                                    {% if contract.is_active %}–î–µ–∞–∫—Ç–∏–≤–∏—Ä–∞–π{% else %}–ê–∫—Ç–∏–≤–∏—Ä–∞–π{% endif %}
                                </button>
                            </form>
                        {% endif %}

                        {% if user.is_superuser %}
                            <form action="{% url 'suppliers:contract-delete' contract.pk %}" method="post" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-outline-danger">–ò–∑—Ç—Ä–∏–π</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="9" class="text-center text-muted">–ù—è–º–∞ –≤—ä–≤–µ–¥–µ–Ω–∏ –¥–æ–≥–æ–≤–æ—Ä–∏.</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {% if user.groups.all.0.name == "Legal" %}
        <a href="{% url 'suppliers:contract-create' %}" class="btn btn-primary mt-3">‚ûï –ù–æ–≤ –¥–æ–≥–æ–≤–æ—Ä</a>
    {% endif %}
</div>
{% endblock %}
